version: '3.1'
services:
  zookeeper:
    image: "confluentinc/cp-zookeeper:5.2.1"
    restart: always
    ports:
      - "2181:2181"
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181

  kafka1:
    image: "confluentinc/cp-kafka:5.2.1"
    depends_on:
      - zookeeper
    restart: always
    ports:
      - "9091:9091"
    volumes:
      - "${TEST_TRUSTSTORE}:/etc/kafka/secrets/truststore.jks"
      - "${TEST_BROKER1_KEYSTORE}:/etc/kafka/secrets/keystore.jks"
      - "${TEST_BROKER1_KEYSTORE_PASSWORD}:/etc/kafka/secrets/keystore.pwd"
      - "${TEST_BROKER1_KEY_PASSWORD}:/etc/kafka/secrets/keystore.keyPwd"
    environment:
      KAFKA_ADVERTISED_LISTENERS: SSL://kafka1:9091
      KAFKA_LISTENERS: SSL://0.0.0.0:9091
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      CONFLUENT_SUPPORT_METRICS_ENABLE: 0
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_INTER_BROKER_LISTENER_NAME: SSL
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS: 1
      KAFKA_BROKER_ID: 1
      KAFKA_NUM_PARTITIONS: 10
      KAFKA_SSL_TRUSTSTORE_LOCATION: "/etc/kafka/secrets/truststore.jks"
      KAFKA_SSL_TRUSTSTORE_PASSWORD: ${TEST_TRUSTSTORE_PASSWORD}
      KAFKA_SSL_KEYSTORE_FILENAME: "keystore.jks"
      KAFKA_SSL_KEYSTORE_CREDENTIALS: "keystore.pwd"
      KAFKA_SSL_KEY_CREDENTIALS: "keystore.keyPwd"

  kafka2:
    image: "confluentinc/cp-kafka:5.2.1"
    depends_on:
      - zookeeper
    restart: always
    ports:
      - "9092:9092"
    volumes:
      - "${TEST_TRUSTSTORE}:/etc/kafka/secrets/truststore.jks"
      - "${TEST_BROKER2_KEYSTORE}:/etc/kafka/secrets/keystore.jks"
      - "${TEST_BROKER2_KEYSTORE_PASSWORD}:/etc/kafka/secrets/keystore.pwd"
      - "${TEST_BROKER2_KEY_PASSWORD}:/etc/kafka/secrets/keystore.keyPwd"
    environment:
      KAFKA_ADVERTISED_LISTENERS: SSL://kafka2:9092
      KAFKA_LISTENERS: SSL://0.0.0.0:9092
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      CONFLUENT_SUPPORT_METRICS_ENABLE: 0
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_INTER_BROKER_LISTENER_NAME: SSL
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS: 1
      KAFKA_BROKER_ID: 2
      KAFKA_NUM_PARTITIONS: 10
      KAFKA_SSL_TRUSTSTORE_LOCATION: "/etc/kafka/secrets/truststore.jks"
      KAFKA_SSL_TRUSTSTORE_PASSWORD: ${TEST_TRUSTSTORE_PASSWORD}
      KAFKA_SSL_KEYSTORE_FILENAME: "keystore.jks"
      KAFKA_SSL_KEYSTORE_CREDENTIALS: "keystore.pwd"
      KAFKA_SSL_KEY_CREDENTIALS: "keystore.keyPwd"

  kafka3:
    image: "confluentinc/cp-kafka:5.2.1"
    depends_on:
      - zookeeper
    restart: always
    ports:
      - "9093:9093"
    volumes:
      - "${TEST_TRUSTSTORE}:/etc/kafka/secrets/truststore.jks"
      - "${TEST_BROKER3_KEYSTORE}:/etc/kafka/secrets/keystore.jks"
      - "${TEST_BROKER3_KEYSTORE_PASSWORD}:/etc/kafka/secrets/keystore.pwd"
      - "${TEST_BROKER3_KEY_PASSWORD}:/etc/kafka/secrets/keystore.keyPwd"
    environment:
      KAFKA_ADVERTISED_LISTENERS: SSL://kafka3:9093
      KAFKA_LISTENERS: SSL://0.0.0.0:9093
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      CONFLUENT_SUPPORT_METRICS_ENABLE: 0
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_INTER_BROKER_LISTENER_NAME: SSL
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS: 1
      KAFKA_BROKER_ID: 3
      KAFKA_NUM_PARTITIONS: 10
      KAFKA_SSL_TRUSTSTORE_LOCATION: "/etc/kafka/secrets/truststore.jks"
      KAFKA_SSL_TRUSTSTORE_PASSWORD: ${TEST_TRUSTSTORE_PASSWORD}
      KAFKA_SSL_KEYSTORE_FILENAME: "keystore.jks"
      KAFKA_SSL_KEYSTORE_CREDENTIALS: "keystore.pwd"
      KAFKA_SSL_KEY_CREDENTIALS: "keystore.keyPwd"